<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="author" content="Y_BlueMond">
        <meta name="format-detection" content="telephone=no">
        <title>BlueMeMond index</title>
        <link rel="stylesheet" href="css/style.css">
    </head>
    <body>
        <h1>BlueMeMond</h1>
        <div id="status"><button class="button button--cta">Login</button></div>
        <div id="signedIn">
            <div class="segment" style="width: 280px; margin: 0 auto;">
                <div class="segment__item">
                    <input type="radio" class="segment__input" name="segment-a" checked>
                    <div class="segment__button">room one</div>
                </div>
                <div class="segment__item">
                    <input type="radio" class="segment__input" name="segment-a">
                    <div class="segment__button">room two</div>
                </div>
                <div class="segment__item">
                    <input type="radio" class="segment__input" name="segment-a">
                    <div class="segment__button">room three</div>
                </div>
            </div>
            <div>
                <textarea id="text" cols="30" rows="10"></textarea>
                <button id="save" class="button button--large--cta" style="width: 95%; margin: 0 auto;">保存</button>
            </div>
        </div>
        <!--scripts-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script type="module">
            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
                apiKey: "AIzaSyAv2pC3rhqDDTGxOMSOj3haGjvNH5zILAk",
                authDomain: "ybluemond.firebaseapp.com",
                databaseURL: "https://ybluemond-default-rtdb.asia-southeast1.firebasedatabase.app",
                projectId: "ybluemond",
                storageBucket: "ybluemond.appspot.com",
                messagingSenderId: "548956595822",
                appId: "1:548956595822:web:52cf473c82b23fe649687f",
                measurementId: "G-LFZXW33JVL"
            };
        </script>
        <script src="script/setup.js"></script>
        <script type="module">
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    const uid = user.uid;
                    if (user !== null) {
                        user.providerData.forEach((profile) => {
                            $("#uname").text(profile.displayName);
                            $("#prof").attr("src",profile.photoURL);
                        });
                        $("#status").fadeOut(500);
                    } else {
                        $("#signedIn").fadeOut(500);
                    }
                    $("#save").on("click",function() {
                        const content = {
                            title: $("#title").val(),
                            text: $("#text").val()
                        }
                        const dbRef = ref( db, "users/"+uid+"/memo/"+$("#title").val() );
                        set(dbRef, msg);
                    });
                    $("#title").on("change",function(){
                        const dbRef = ref( db, "users/"+uid+"/memo/"+$("this").val() );
                        onValue(dbRef, function(data){
                            const msg = data.val();
                            $("#text").val(msg.text);
                        });
                    });
                } else {
                    function _redirect(){
                        location.href="login.html";
                    }
                }
            })
        </script>
    </body>
</html>